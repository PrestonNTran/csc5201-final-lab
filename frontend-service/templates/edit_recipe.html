{% extends "layout.html" %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto;">
    
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>Edit Recipe</h2>
        <a href="/recipes"><button style="background: var(--background-alt); color: var(--text-main);">‚Üê Back to Catalog</button></a>
    </div>

    <div style="background: var(--background); padding: 30px; border: 1px solid var(--border); border-radius: 8px;">
        <form action="/recipes/update/{{ recipe.id }}" method="POST">
            <label>Recipe Name</label>
            <input type="text" name="name" value="{{ recipe.name }}" required style="width: 100%;">

            <label>Ingredients</label>
            <div id="ingredients-container">
                {% for ing in recipe.ingredients %}
                <div class="input-group">
                    <input type="text" name="items[]" value="{{ ing.item }}" required style="flex: 2;">
                    <input type="number" name="amounts[]" value="{{ ing.amount }}" step="0.1" required style="flex: 1;">
                    <select name="units[]" style="flex: 1;">
                        {% for u in units %}
                            <option value="{{ u }}" {% if u == ing.unit %}selected{% endif %}>{{ u }}</option>
                        {% endfor %}
                    </select>
                    <button type="button" class="danger" onclick="this.parentElement.remove()" style="padding: 0 10px;">X</button>
                </div>
                {% endfor %}
            </div>
            
            <button type="button" onclick="addIngredientRow()" style="width: 100%; background: var(--background-alt); color: var(--text-main); margin-bottom: 20px;">+ Add Ingredient</button>

            <label>Instructions</label>
            <textarea name="instructions" rows="6" style="width: 100%;">{{ recipe.instructions }}</textarea>

            <button type="submit" style="width: 100%; margin-top: 10px;">Update Recipe</button>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function addIngredientRow() {
        const container = document.getElementById('ingredients-container');
        const div = document.createElement('div');
        div.className = 'input-group';
        div.innerHTML = `
            <input type="text" name="items[]" placeholder="Item" required style="flex: 2;">
            <input type="number" name="amounts[]" step="0.1" placeholder="Qty" required style="flex: 1;">
            <select name="units[]" style="flex: 1;">
                {% for u in units %}
                    <option value="{{ u }}">{{ u }}</option>
                {% endfor %}
            </select>
            <button type="button" class="danger" onclick="this.parentElement.remove()" style="padding: 0 10px;">X</button>
        `;
        container.appendChild(div);
    }
</script>
{% endblock %}