{% extends "layout.html" %}

{% block content %}
<style>
    details {
        background: var(--background-alt);
        border: 1px solid var(--border);
        border-radius: 8px;
        margin-bottom: 15px;
        padding: 10px;
    }
    summary {
        font-weight: bold;
        cursor: pointer;
        padding: 5px;
    }
    .recipe-actions {
        display: flex;
        gap: 10px;
        margin-top: 15px;
        border-top: 1px solid var(--border);
        padding-top: 10px;
    }
</style>

<h2>Recipe Catalog</h2>

<div style="display: grid; grid-template-columns: 7fr 3fr; gap: 40px;">
    
    <div>
        {% for r in recipes %}
        <details>
            <summary>{{ r.name }}</summary>
            <div style="padding: 10px;">
                <h4>Ingredients</h4>
                <ul>
                    {% for ing in r.ingredients %}
                    <li>{{ ing.amount }} {{ ing.unit }} of {{ ing.item }}</li>
                    {% endfor %}
                </ul>
                <h4>Instructions</h4>
                <p style="white-space: pre-wrap;">{{ r.instructions }}</p>
                
                <div class="recipe-actions">
                    <a href="/recipes/edit/{{ r.id }}" style="text-decoration: none;">
                        <button style="padding: 5px 15px;">Edit</button>
                    </a>
                    <form action="/recipes/delete/{{ r.id }}" method="POST" style="margin: 0;">
                        <button class="danger" style="padding: 5px 15px;">X</button>
                    </form>
                </div>
            </div>
        </details>
        {% else %}
        <p style="text-align: center;">No recipes found. Create one!</p>
        {% endfor %}
    </div>

    <div>
        <div style="position: sticky; top: 20px; background: var(--background); padding: 20px; border: 1px solid var(--border); border-radius: 8px;">
            <h3 style="margin-top: 0;">New Recipe</h3>
            <form action="/recipes/create" method="POST">
                <label>Recipe Name</label>
                <input type="text" name="name" required style="width: 100%;">

                <label>Ingredients</label>
                <div id="ingredients-container">
                    </div>
                <button type="button" onclick="addIngredientRow()" style="width: 100%; background: var(--background-alt); color: var(--text-main); margin-bottom: 15px;">+ Add Ingredient</button>

                <label>Instructions</label>
                <textarea name="instructions" rows="4" style="width: 100%;"></textarea>

                <button type="submit" style="width: 100%; margin-top: 10px;">Save Recipe</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    window.onload = addIngredientRow;

    function addIngredientRow() {
        const container = document.getElementById('ingredients-container');
        const div = document.createElement('div');
        div.className = 'input-group';
        div.innerHTML = `
            <input type="text" name="items[]" placeholder="Item" required style="flex: 2;">
            <input type="number" name="amounts[]" step="0.1" placeholder="Qty" required style="flex: 1; min-width: 60px;">
            <select name="units[]" style="flex: 1; min-width: 70px;">
                {% for u in units %}
                    <option value="{{ u }}">{{ u }}</option>
                {% endfor %}
            </select>
            <button type="button" class="danger" onclick="this.parentElement.remove()" style="padding: 0 10px;">X</button>
        `;
        container.appendChild(div);
    }
</script>
{% endblock %}